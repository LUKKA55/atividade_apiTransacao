"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.calculateDigit = exports.isValidCnpj = void 0;
const isRepetead_1 = require("../utils/isRepetead");
const mod11_1 = require("../utils/mod11");
function isValidCnpj(value) {
    const cnpjClean = value.replace(/\D/g, '');
    const sizeCnpj = 14;
    if (cnpjClean.length !== sizeCnpj)
        return false;
    if ((0, isRepetead_1.isRepeated)(cnpjClean))
        return false;
    const baseCnpj = cnpjClean.substring(0, 12);
    const firstDigit = calculateDigit(baseCnpj);
    const baseCnpjWithFirtDigit = baseCnpj + firstDigit;
    const secondDigit = calculateDigit(baseCnpjWithFirtDigit);
    const cnpjCompare = baseCnpjWithFirtDigit + secondDigit;
    return cnpjCompare === cnpjClean;
}
exports.isValidCnpj = isValidCnpj;
function calculateDigit(baseCnpj) {
    const digitsCnpjBase = baseCnpj.split('');
    let sumDigits = 0;
    let mult = 2;
    for (let index = digitsCnpjBase.length - 1; index >= 0; index--) {
        if (mult > 9)
            mult = 2;
        sumDigits += Number(digitsCnpjBase[index]) * mult;
        mult++;
    }
    return ((0, mod11_1.mod11)(sumDigits)) < 2 ? 0 : (11 - (0, mod11_1.mod11)(sumDigits));
}
exports.calculateDigit = calculateDigit;
